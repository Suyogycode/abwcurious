import React, { useEffect, useRef, useState } from 'react';
import { BookOpen, Bot, Layers, ArrowRight } from 'lucide-react';
import gsap from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

gsap.registerPlugin(ScrollTrigger);

// --- 0. GLOBAL NOISE TEXTURE (For that physical, breathable feel) ---
const NoiseOverlay = () => (
  <svg className="pointer-events-none fixed inset-0 z-50 h-full w-full opacity-[0.05] mix-blend-overlay">
    <filter id="noise">
      <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch" />
    </filter>
    <rect width="100%" height="100%" filter="url(#noise)" />
  </svg>
);

// --- 1. NAVBAR: The Floating Island ---
const CinematicNavbar = () => {
  const navRef = useRef(null);

  useEffect(() => {
    const ctx = gsap.context(() => {
      ScrollTrigger.create({
        start: 'top -50',
        end: 99999,
        toggleClass: { className: 'bg-[#F2F0E9]/80 backdrop-blur-xl border-[#2E4036]/10 text-[#1A1A1A]', targets: navRef.current },
        onEnter: () => gsap.to(navRef.current, { color: '#1A1A1A', duration: 0.3 }),
        onLeaveBack: () => gsap.to(navRef.current, { backgroundColor: 'transparent', color: '#F2F0E9', border: '1px solid transparent', duration: 0.3 })
      });
    }, navRef);
    return () => ctx.revert();
  }, []);

  return (
    <div className="fixed top-6 left-1/2 -translate-x-1/2 z-50 w-[90%] max-w-6xl">
      <nav ref={navRef} className="flex items-center justify-between px-6 py-4 rounded-[2rem] border border-transparent text-[#F2F0E9] transition-all duration-500">
        <div className="flex flex-col">
           <span className="font-sans font-bold tracking-tight text-xl">ABW<span className="text-[#CC5833] italic font-serif">curious</span></span>
           <span className="text-[10px] font-mono tracking-widest opacity-70">A BETTER WAY OF LEARNING</span>
        </div>
        <div className="hidden md:flex gap-8 font-mono text-sm uppercase tracking-widest items-center">
          <a href="#home" className="hover:text-[#CC5833] transition-colors">Home</a>
          <a href="#login" className="hover:text-[#CC5833] transition-colors">Login</a>
          <button className="px-5 py-2 bg-[#CC5833] text-[#F2F0E9] rounded-full text-sm font-bold hover:scale-[1.03] transition-transform">
            Sign Up
          </button>
        </div>
      </nav>
    </div>
  );
};

// --- 2. INTERACTIVE FEATURE CARDS ---

// Card 1: Diagnostic Shuffler (Personalized Learning)
const ShufflerCard = () => {
  const [active, setActive] = useState(0);
  const items = ["Skill Level Mapping", "Adaptive Pacing", "Interest-Based Paths"];

  useEffect(() => {
    const interval = setInterval(() => setActive((prev) => (prev + 1) % 3), 3000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="h-full bg-[#F2F0E9] p-8 rounded-[2rem] shadow-sm border border-[#2E4036]/5 flex flex-col justify-between group">
      <div>
        <BookOpen className="text-[#CC5833] mb-6" size={28} />
        <h3 className="font-sans font-bold text-[#1A1A1A] text-xl mb-2">Personalized Learning</h3>
        <p className="font-serif italic text-[#2E4036]/70 mb-8">Curriculum that shifts with your mind.</p>
      </div>
      <div className="relative h-24">
        {items.map((item, idx) => {
          const offset = (idx - active + 3) % 3;
          return (
            <div
              key={idx}
              className="absolute w-full p-4 bg-white rounded-xl border border-[#2E4036]/10 text-sm font-mono transition-all duration-700 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
              style={{
                top: offset * 10,
                scale: 1 - offset * 0.05,
                zIndex: 10 - offset,
                opacity: offset === 2 ? 0 : 1
              }}
            >
              <span className="text-[#CC5833]">►</span> {item}
            </div>
          );
        })}
      </div>
    </div>
  );
};

// Card 2: Telemetry Typewriter (AI Tutor)
const TypewriterCard = () => {
  const [text, setText] = useState("");
  const fullText = "Analyzing knowledge gaps... Contextualizing complex topics... Generating personalized answer...";

  useEffect(() => {
    let i = 0;
    const typing = setInterval(() => {
      setText(fullText.slice(0, i));
      i++;
      if (i > fullText.length) i = 0;
    }, 80);
    return () => clearInterval(typing);
  }, []);

  return (
    <div className="h-full bg-[#F2F0E9] p-8 rounded-[2rem] shadow-sm border border-[#2E4036]/5 flex flex-col justify-between">
      <div>
        <div className="flex justify-between items-center mb-6">
          <Bot className="text-[#CC5833]" size={28} />
          <div className="flex items-center gap-2 text-xs font-mono text-[#2E4036]/50">
            <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> 24/7 Active
          </div>
        </div>
        <h3 className="font-sans font-bold text-[#1A1A1A] text-xl mb-2">AI Tutor</h3>
        <p className="font-serif italic text-[#2E4036]/70 mb-8">Instant, context-aware assistance.</p>
      </div>
      <div className="bg-[#2E4036] p-4 rounded-xl h-32 font-mono text-xs text-[#F2F0E9]/80 leading-relaxed overflow-hidden relative">
        {text}<span className="text-[#CC5833] animate-pulse">_</span>
      </div>
    </div>
  );
};

// Card 3: Cursor Protocol Scheduler (Interactive Learning)
const CursorCard = () => {
  return (
    <div className="h-full bg-[#F2F0E9] p-8 rounded-[2rem] shadow-sm border border-[#2E4036]/5 flex flex-col justify-between overflow-hidden relative group">
      <div>
        <Layers className="text-[#CC5833] mb-6" size={28} />
        <h3 className="font-sans font-bold text-[#1A1A1A] text-xl mb-2">Interactive AR</h3>
        <p className="font-serif italic text-[#2E4036]/70 mb-8">High-definition immersive content.</p>
      </div>
      
      <div className="grid grid-cols-4 gap-2 mt-4">
        {[...Array(12)].map((_, i) => (
          <div key={i} className={`h-10 rounded-md border border-[#2E4036]/10 flex items-center justify-center transition-colors duration-300 ${i === 5 || i === 10 ? 'bg-[#CC5833]/20 group-hover:bg-[#CC5833] group-hover:text-white' : 'bg-white'}`}>
             <span className="text-[10px] opacity-20 font-mono">Mod {i+1}</span>
          </div>
        ))}
        {/* Animated simulated cursor */}
        <div className="absolute w-5 h-5 text-[#1A1A1A] bottom-12 right-12 opacity-0 group-hover:opacity-100 transition-opacity duration-300 animate-[bounce_2s_infinite]">
          <svg viewBox="0 0 24 24" fill="currentColor" stroke="white" strokeWidth="1"><path d="M5.5 3.21V20.8c0 .45.54.67.85.35l4.86-4.86a.5.5 0 01.35-.15h6.42c.41 0 .75-.34.75-.75V3.21c0-.41-.34-.75-.75-.75H6.25c-.41 0-.75.34-.75.75z"/></svg>
        </div>
      </div>
    </div>
  );
};

// --- MAIN PAGE ASSEMBLER ---
export default function ABWCuriousHome() {
  const heroRef = useRef(null);
  const philosophyRef = useRef(null);

  useEffect(() => {
    let ctx = gsap.context(() => {
      // Hero Animation
      gsap.from(".hero-element", {
        y: 40,
        opacity: 0,
        stagger: 0.15,
        duration: 1.2,
        ease: "power3.out",
        delay: 0.2
      });

      // Philosophy Animation
      gsap.from(".philosophy-text", {
        scrollTrigger: {
          trigger: philosophyRef.current,
          start: "top 70%",
        },
        y: 30,
        opacity: 0,
        stagger: 0.2,
        duration: 1,
        ease: "power2.out"
      });
      
      // Pinning cards
      const cards = gsap.utils.toArray('.archive-card');
      cards.forEach((card, i) => {
        ScrollTrigger.create({
          trigger: card,
          start: "top top+=100",
          endTrigger: ".archive-container",
          end: "bottom bottom",
          pin: true,
          pinSpacing: false,
        });
        
        if (i > 0) {
            gsap.to(cards[i - 1], {
                scale: 0.9,
                opacity: 0.5,
                filter: "blur(10px)",
                scrollTrigger: {
                    trigger: card,
                    start: "top bottom",
                    end: "top top+=100",
                    scrub: true,
                }
            });
        }
      });
    });
    return () => ctx.revert();
  }, []);

  return (
    <div className="relative min-h-screen bg-[#F2F0E9] selection:bg-[#CC5833] selection:text-[#F2F0E9] font-sans">
      <NoiseOverlay />
      <CinematicNavbar />

      {/* 3. HERO SECTION */}
      <section ref={heroRef} className="relative h-[100dvh] w-full overflow-hidden bg-[#2E4036] flex items-end pb-24 px-6 md:px-12">
        <div className="absolute inset-0 z-0">
          {/* Earthy, calm study/library vibe */}
          <img 
            src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?q=80&w=2000&auto=format&fit=crop" 
            alt="Library Texture" 
            className="w-full h-full object-cover opacity-30 mix-blend-luminosity"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-[#2E4036] via-[#2E4036]/80 to-transparent"></div>
        </div>

        <div className="relative z-10 max-w-4xl">
          <div className="hero-element flex items-center gap-3 mb-6">
            <span className="text-[#CC5833] font-mono text-sm tracking-widest uppercase">Cognitive Science + AI</span>
            <span className="h-[1px] w-12 bg-[#CC5833]/50" />
          </div>

          <h1 className="hero-element text-[#F2F0E9] leading-[0.9] tracking-tighter mb-8 flex flex-col">
            <span className="text-5xl md:text-7xl font-sans font-bold">Curiosity is the</span>
            <span className="text-7xl md:text-9xl font-serif italic text-[#CC5833] pr-4">Catalyst.</span>
          </h1>

          <p className="hero-element text-[#F2F0E9]/70 text-lg md:text-xl max-w-xl font-light leading-relaxed mb-10">
            Discover a smarter way to learn with interactive, adaptive education tailored entirely to your unique cognitive footprint.
          </p>

          <div className="hero-element flex gap-4">
              <button className="px-8 py-4 bg-[#CC5833] text-[#F2F0E9] font-bold rounded-full flex items-center gap-3 hover:scale-[1.03] transition-transform shadow-xl">
                Get Started <ArrowRight size={18} />
              </button>
              <button className="px-8 py-4 bg-transparent border border-[#F2F0E9]/30 text-[#F2F0E9] font-bold rounded-full hover:bg-[#F2F0E9]/10 transition-colors">
                Learn More
              </button>
          </div>
        </div>
      </section>

      {/* 4. FEATURES SECTION */}
      <section className="py-32 bg-[#F2F0E9] px-6 relative z-20">
        <div className="max-w-7xl mx-auto">
          <div className="mb-20">
            <h2 className="text-4xl md:text-5xl font-sans font-bold text-[#1A1A1A] mb-4">How ABWcurious Works</h2>
            <p className="font-serif italic text-2xl text-[#2E4036]/70">We combine cognitive science with cutting-edge technology.</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8 h-auto md:h-[400px]">
            <ShufflerCard />
            <TypewriterCard />
            <CursorCard />
          </div>
        </div>
      </section>

      {/* 5. THE MANIFESTO (Philosophy) */}
      <section ref={philosophyRef} className="py-40 bg-[#2E4036] px-6 relative overflow-hidden">
        <div className="max-w-5xl mx-auto relative z-10 text-center">
          <p className="philosophy-text text-[#F2F0E9]/50 font-sans text-lg md:text-2xl mb-8">
            Most platforms focus on: <span className="underline decoration-[#CC5833]/50 underline-offset-4">standardized testing and rigid pacing.</span>
          </p>
          <h2 className="philosophy-text text-5xl md:text-7xl font-serif italic text-[#F2F0E9] leading-tight">
            We focus on: <br />
            <span className="text-[#CC5833]">adaptive evolution.</span>
          </h2>
        </div>
      </section>

      {/* 6. PROTOCOL (Stacking Archive) */}
      <section className="archive-container bg-[#F2F0E9] py-32 px-6 relative h-[250vh]">
         <div className="max-w-4xl mx-auto relative">
            
            <div className="archive-card w-full h-[60vh] bg-white rounded-[3rem] p-12 shadow-xl border border-[#2E4036]/10 flex flex-col justify-center relative overflow-hidden mb-8">
               <div className="text-8xl font-serif italic text-[#2E4036]/10 absolute -top-4 -right-4">01</div>
               <h3 className="text-4xl font-sans font-bold text-[#1A1A1A] mb-4">Baseline Assessment</h3>
               <p className="text-xl font-serif text-[#2E4036]/80 max-w-lg">
                 Before you start, our engine analyzes your current knowledge base and preferred learning modalities to build a custom curriculum graph.
               </p>
            </div>

            <div className="archive-card w-full h-[60vh] bg-[#F2F0E9] rounded-[3rem] p-12 shadow-2xl border border-[#2E4036]/20 flex flex-col justify-center relative overflow-hidden mb-8">
               <div className="text-8xl font-serif italic text-[#CC5833]/10 absolute -top-4 -right-4">02</div>
               <h3 className="text-4xl font-sans font-bold text-[#1A1A1A] mb-4">Active Synthesis</h3>
               <p className="text-xl font-serif text-[#2E4036]/80 max-w-lg">
                 Move away from passive video watching. Engage with immersive AR modules and let your AI Tutor test your comprehension in real-time.
               </p>
            </div>

         </div>
      </section>

      {/* 7. FOOTER */}
      <footer className="bg-[#1A1A1A] text-[#F2F0E9] pt-20 pb-10 px-6 rounded-t-[4rem] relative z-20">
        <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-12 mb-20">
          <div>
             <h2 className="text-4xl font-sans font-bold mb-4">ABW<span className="text-[#CC5833] font-serif italic">curious</span></h2>
            <p className="font-serif italic text-gray-400">A Better Way of Learning.</p>
          </div>
          <div className="flex flex-col md:items-end justify-center">
             <div className="flex items-center gap-3 font-mono text-sm bg-white/5 px-4 py-2 rounded-full border border-white/10">
                <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                AI Core Online
             </div>
          </div>
        </div>
        <div className="max-w-7xl mx-auto text-center font-mono text-xs text-gray-500 border-t border-white/10 pt-8">
          © {new Date().getFullYear()} ABWcurious. All rights reserved.
        </div>
      </footer>
    </div>
  );
}
